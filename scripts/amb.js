document.addEventListener('DOMContentLoaded', () => {

  // üîπ JSON interno com dados simplificados
  const data = {
    "feminino": [
  {"idade_min": "1.0","idade_max": "1.9","P5": "8.9","P10": "9.7","P15": "10.1","P25": "10.8","P50": "12.3","P75": "13.8","P85": "14.6","P90": "15.3","P95": "16.2"},
  {"idade_min": "2.0","idade_max": "1.1","P5": "10.1","P10": "10.6","P15": "10.9","P25": "11.8","P50": "13.2","P75": "14.7","P85": "15.6","P90": "16.4","P95": "17.3"},
  {"idade_min": "3.0","idade_max": "2.1","P5": "10.8","P10": "11.4","P15": "11.8","P25": "12.6","P50": "14.3","P75": "15.8","P85": "16.7","P90": "17.4","P95": "18.8"},
  {"idade_min": "4.0","idade_max": "3.1","P5": "11.2","P10": "12.2","P15": "12.7","P25": "13.6","P50": "15.3","P75": "17.0","P85": "18.0","P90": "18.6","P95": "19.8"},
  {"idade_min": "5.0","idade_max": "4.1","P5": "12.4","P10": "13.2","P15": "13.9","P25": "14.8","P50": "16.4","P75": "18.3","P85": "19.4","P90": "20.6","P95": "22.1"},
  {"idade_min": "6.0","idade_max": "5.1","P5": "13.5","P10": "14.1","P15": "14.6","P25": "15.6","P50": "17.4","P75": "19.5","P85": "21.0","P90": "22.0","P95": "24.2"},
  {"idade_min": "7.0","idade_max": "6.1","P5": "14.4","P10": "15.2","P15": "15.8","P25": "16.7","P50": "18.9","P75": "21.2","P85": "22.6","P90": "23.9","P95": "25.3"},
  {"idade_min": "8.0","idade_max": "7.1.","P5": "15.2","P10": "16.0","P15": "16.8","P25": "18.2","P50": "20.8","P75": "23.2","P85": "24.6","P90": "26.5","P95": "28.0"},
  {"idade_min": "9.0","idade_max": "8.1","P5": "17.0","P10": "17.9","P15": "18.7","P25": "19.8","P50": "21.9","P75": "25.4","P85": "27.2","P90": "28.3","P95": "31.1"},
  {"idade_min": "10.0","idade_max": "10.9","P5": "17.6","P10": "18.5","P15": "19.3","P25": "20.9","P50": "23.8","P75": "27.0","P85": "29.1","P90": "31.0","P95": "33.1"},
  {"idade_min": "11.0","idade_max": "11.9","P5": "19.5","P10": "21.0","P15": "21.7","P25": "23.2","P50": "26.4","P75": "30.7","P85": "33.5","P90": "35.7","P95": "39.2"},
  {"idade_min": "12.0","idade_max": "12.9","P5": "20.4","P10": "21.8","P15": "23.1","P25": "25.5","P50": "29.0","P75": "33.2","P85": "36.3","P90": "37.8","P95": "40.5"},
  {"idade_min": "13.0","idade_max": "13.9","P5": "22.8","P10": "24.5","P15": "25.4","P25": "27.1","P50": "30.8","P75": "35.3","P85": "38.1","P90": "39.6","P95": "43.7"},
  {"idade_min": "14.0","idade_max": "14.9","P5": "24.0","P10": "26.2","P15": "27.1","P25": "29.0","P50": "32.8","P75": "36.9","P85": "39.8","P90": "42.3","P95": "47.5"},
  {"idade_min": "15.0","idade_max": "15.9","P5": "24.4","P10": "25.8","P15": "27.5","P25": "29.2","P50": "33.0","P75": "37.3","P85": "40.2","P90": "41.7","P95": "45.9"},
  {"idade_min": "16.0","idade_max": "16.9","P5": "25.2","P10": "26.8","P15": "28.2","P25": "30.0","P50": "33.6","P75": "38.0","P85": "40.2","P90": "43.7","P95": "48.3"},
  {"idade_min": "17.0","idade_max": "17.9","P5": "25.9","P10": "27.5","P15": "28.9","P25": "30.7","P50": "34.3","P75": "39.6","P85": "43.4","P90": "46.2","P95": "50.8"},
  {"idade_min": "18.0","idade_max": "24.9","P5": "19.5","P10": "21.5","P15": "22.8","P25": "24.5","P50": "28.3","P75": "33.1","P85": "36.4","P90": "39.0","P95": "44.2"},
  {"idade_min": "25.0","idade_max": "29.9","P5": "20.5","P10": "21.9","P15": "23.1","P25": "25.2","P50": "29.4","P75": "34.9","P85": "38.5","P90": "41.9","P95": "47.8"},
  {"idade_min": "30.0","idade_max": "34.9","P5": "21.1","P10": "23.0","P15": "24.2","P25": "26.3","P50": "30.9","P75": "36.8","P85": "41.2","P90": "44.7","P95": "51.3"},
  {"idade_min": "35.0","idade_max": "39.9","P5": "21.1","P10": "23.4","P15": "24.7","P25": "27.3","P50": "31.8","P75": "38.7","P85": "43.1","P90": "46.1","P95": "54.2"},
  {"idade_min": "40.0","idade_max": "44.9","P5": "21.3","P10": "23.4","P15": "25.5","P25": "27.5","P50": "32.3","P75": "39.8","P85": "45.8","P90": "49.5","P95": "55.8"},
  {"idade_min": "45.0","idade_max": "49.9","P5": "21.6","P10": "23.1","P15": "24.8","P25": "27.4","P50": "32.5","P75": "39.5","P85": "44.7","P90": "48.4","P95": "56.1"},
  {"idade_min": "50.0","idade_max": "59.4","P5": "22.2","P10": "24.6","P15": "25.7","P25": "28.3","P50": "33.4","P75": "40.4","P85": "46.1","P90": "49.6","P95": "55.6"},
  {"idade_min": "55.0","idade_max": "59.9","P5": "22.8","P10": "24.8","P15": "26.5","P25": "28.7","P50": "34.7","P75": "42.3","P85": "47.3","P90": "52.1","P95": "58.8"},
  {"idade_min": "60.0","idade_max": "64.9","P5": "22.4","P10": "24.5","P15": "26.3","P25": "29.2","P50": "34.5","P75": "41.1","P85": "45.6","P90": "49.1","P95": "55.1"},
  {"idade_min": "65.0","idade_max": "69.9","P5": "21.9","P10": "24.5","P15": "26.2","P25": "28.9","P50": "34.6","P75": "41.6","P85": "46.3","P90": "49.6","P95": "56.5"},
  {"idade_min": "70.0","idade_max": "74.9","P5": "22.2","P10": "24.4","P15": "26.0","P25": "28.8","P50": "34.3","P75": "41.8","P85": "46.4","P90": "49.2","P95": "54.6"}
] ,
    "masculino": [
  {"idade_min": "1.0","idade_max": "1.9","P5": "9.7","P10": "10.4","P15": "10.8","P25": "11.6","P50": "13.0","P75": "14.6","P85": "15.4","P90": "16.3","P95": "17.2"},
  {"idade_min": "2.0","idade_max": "1.1","P5": "10.1","P10": "10.9","P15": "11.3","P25": "12.4","P50": "13.9","P75": "15.6","P85": "16.4","P90": "16.9","P95": "18.4"},
  {"idade_min": "3.0","idade_max": "2.1","P5": "11.2","P10": "12.0","P15": "12.6","P25": "13.5","P50": "15.0","P75": "16.4","P85": "17.4","P90": "18.3","P95": "19.5"},
  {"idade_min": "4.0","idade_max": "3.1","P5": "12.0","P10": "12.9","P15": "13.5","P25": "14.5","P50": "16.2","P75": "17.9","P85": "18.8","P90": "19.8","P95": "20.9"},
  {"idade_min": "5.0","idade_max": "4.1","P5": "13.2","P10": "14.2","P15": "14.7","P25": "15.7","P50": "17.6","P75": "19.5","P85": "20.7","P90": "21.7","P95": "23.2"},
  {"idade_min": "6.0","idade_max": "5.1","P5": "14.4","P10": "15.3","P15": "15.8","P25": "16.8","P50": "18.7","P75": "21.3","P85": "22.9","P90": "23.8","P95": "25.7"},
  {"idade_min": "7.0","idade_max": "6.1","P5": "15.1","P10": "16.2","P15": "17.0","P25": "18.5","P50": "20.6","P75": "22.6","P85": "24.5","P90": "25.2","P95": "28.6"},
  {"idade_min": "8.0","idade_max": "7.1.","P5": "16.3","P10": "17.8","P15": "18.5","P25": "19.5","P50": "21.6","P75": "24.0","P85": "25.5","P90": "26.6","P95": "29.0"},
  {"idade_min": "9.0","idade_max": "8.1","P5": "18.2","P10": "19.3","P15": "20.3","P25": "21.7","P50": "23.5","P75": "26.7","P85": "28.7","P90": "30.4","P95": "32.9"},
  {"idade_min": "10.0","idade_max": "10.9","P5": "19.6","P10": "20.7","P15": "21.6","P25": "23.0","P50": "25.7","P75": "29.0","P85": "32.2","P90": "34.0","P95": "37.1"},
  {"idade_min": "11.0","idade_max": "11.9","P5": "21.0","P10": "22.0","P15": "23.0","P25": "24.8","P50": "27.7","P75": "31.6","P85": "33.6","P90": "36.1","P95": "40.3"},
  {"idade_min": "12.0","idade_max": "12.9","P5": "22.6","P10": "24.1","P15": "25.3","P25": "26.9","P50": "30.4","P75": "35.9","P85": "39.3","P90": "40.9","P95": "44.9"},
  {"idade_min": "13.0","idade_max": "13.9","P5": "24.5","P10": "26.7","P15": "28.1","P25": "30.4","P50": "35.7","P75": "41.3","P85": "45.3","P90": "48.1","P95": "52.5"},
  {"idade_min": "14.0","idade_max": "14.9","P5": "28.3","P10": "31.3","P15": "33.1","P25": "36.1","P50": "41.9","P75": "47.4","P85": "51.3","P90": "54.0","P95": "57.5"},
  {"idade_min": "15.0","idade_max": "15.9","P5": "31.9","P10": "34.9","P15": "36.9","P25": "40.3","P50": "46.3","P75": "53.1","P85": "56.3","P90": "57.7","P95": "63.0"},
  {"idade_min": "16.0","idade_max": "16.9","P5": "37.0","P10": "40.9","P15": "42.4","P25": "45.9","P50": "51.9","P75": "57.8","P85": "63.3","P90": "66.2","P95": "70.5"},
  {"idade_min": "17.0","idade_max": "17.9","P5": "39.6","P10": "42.6","P15": "44.8","P25": "48.0","P50": "53.4","P75": "60.4","P85": "64.3","P90": "67.9","P95": "73.1"},
  {"idade_min": "18.0","idade_max": "24.9","P5": "34.2","P10": "37.3","P15": "39.6","P25": "42.7","P50": "49.4","P75": "57.1","P85": "61.8","P90": "65.0","P95": "72.0"},
  {"idade_min": "25.0","idade_max": "29.9","P5": "36.6","P10": "39.9","P15": "42.4","P25": "46.0","P50": "53.0","P75": "61.4","P85": "66.1","P90": "68.9","P95": "74.5"},
  {"idade_min": "30.0","idade_max": "34.9","P5": "37.9","P10": "40.9","P15": "43.4","P25": "47.3","P50": "54.4","P75": "63.2","P85": "67.6","P90": "70.8","P95": "76.1"},
  {"idade_min": "35.0","idade_max": "39.9","P5": "38.5","P10": "42.6","P15": "44.6","P25": "47.9","P50": "55.3","P75": "64.0","P85": "69.1","P90": "72.7","P95": "77.6"},
  {"idade_min": "40.0","idade_max": "44.9","P5": "38.4","P10": "42.1","P15": "45.1","P25": "48.7","P50": "56.0","P75": "64.0","P85": "68.5","P90": "71.6","P95": "77.0"},
  {"idade_min": "45.0","idade_max": "49.9","P5": "37.7","P10": "41.3","P15": "43.7","P25": "47.9","P50": "55.2","P75": "63.3","P85": "68.4","P90": "72.2","P95": "76.2"},
  {"idade_min": "50.0","idade_max": "59.4","P5": "36.0","P10": "40.0","P15": "42.7","P25": "46.6","P50": "54.0","P75": "62.7","P85": "67.0","P90": "70.4","P95": "77.4"},
  {"idade_min": "55.0","idade_max": "59.9","P5": "36.5","P10": "40.8","P15": "42.7","P25": "46.7","P50": "54.3","P75": "61.9","P85": "66.4","P90": "69.6","P95": "75.1"},
  {"idade_min": "60.0","idade_max": "64.9","P5": "34.5","P10": "38.7","P15": "41.2","P25": "44.9","P50": "52.1","P75": "60.0","P85": "64.8","P90": "67.5","P95": "71.6"},
  {"idade_min": "65.0","idade_max": "69.9","P5": "31.4","P10": "35.8","P15": "38.4","P25": "42.3","P50": "49.1","P75": "57.3","P85": "61.2","P90": "64.3","P95": "69.4"},
  {"idade_min": "70.0","idade_max": "74.9","P5": "29.7","P10": "33.8","P15": "36.1","P25": "40.2","P50": "47.0","P75": "54.6","P85": "59.1","P90": "62.1","P95": "67.3"}
]
};

  const calcularBtn = document.getElementById('calcularBtn');
  const resultado = document.getElementById('resultado');

  calcularBtn.addEventListener('click', () => {
    const sexo = document.getElementById('sexo').value;
    const idade = parseFloat(document.getElementById('idade').value);
    const amb = parseFloat(document.getElementById('amb').value);

    if (!sexo || isNaN(idade) || isNaN(amb)) {
      alert("Por favor, preencha todos os campos.");
      return;
    }

    const tabela = data[sexo];
    if (!tabela) {
      resultado.innerHTML = "<p>Sexo inv√°lido.</p>";
      return;
    }

    // üîπ Localiza faixa et√°ria correspondente
    const linha = tabela.find(l => idade >= l.idade_min && idade <= l.idade_max);
    if (!linha) {
      resultado.innerHTML = "<p>Idade fora da faixa dispon√≠vel na tabela.</p>";
      return;
    }

    // üîπ Extrai os percentis
    const percentis = Object.entries(linha)
      .filter(([k]) => k.startsWith("P"))
      .map(([k, v]) => ({ nome: k, valor: v, numero: parseFloat(k.replace("P", "")) }));

    let msg = "";
    let percentilFinal = 0;

    const menor = percentis.find(p => amb <= p.valor);
    const anterior = percentis[percentis.indexOf(menor) - 1];

    if (!menor) {
      msg = `Acima do ${percentis.at(-1).nome} (${percentis.at(-1).valor} cm)`;
      percentilFinal = 100;
    } else if (!anterior) {
      msg = `Abaixo do ${percentis[0].nome} (${percentis[0].valor} cm)`;
      percentilFinal = 0;
    } else if (amb === menor.valor) {
      msg = `Igual ao ${menor.nome} (${menor.valor} cm)`;
      percentilFinal = menor.numero;
    } else {
      msg = `Entre ${anterior.nome} (${anterior.valor} cm) e ${menor.nome} (${menor.valor} cm)`;
      // üîπ Interpola percentil intermedi√°rio (aproximado)
      const proporcao = (amb - anterior.valor) / (menor.valor - anterior.valor);
      percentilFinal = anterior.numero + proporcao * (menor.numero - anterior.numero);
    }

    // üîπ Determina o estado de gordura
    let estado = "";
    if (percentilFinal <= 5) estado = "Baixa musculatura";
    else if (percentilFinal <= 15) estado = "Abaixo da m√©dia";
    else if (percentilFinal <= 85) estado = "M√©dia";
    else if (percentilFinal <= 95) estado = "Acima da m√©dia";
    else estado = "Alta musculatura";

    // üîπ Exibe resultado formatado
    resultado.innerHTML = `
      <h2>Resultado</h2>
      <p><strong>Sexo:</strong> ${sexo.charAt(0).toUpperCase() + sexo.slice(1)}</p>
      <p><strong>Idade:</strong> ${idade} anos</p>
      <p><strong>Circunfer√™ncia:</strong> ${amb} cm</p>
      <p><strong>Classifica√ß√£o:</strong> ${msg}</p>
      <p><strong>Estado de gordura:</strong> ${estado}</p>
    `;
  });
}
);
